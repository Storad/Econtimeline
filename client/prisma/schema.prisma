// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Trade {
  id         String   @id @default(cuid())
  userId     String   // Clerk user ID
  date       String   // Format: YYYY-MM-DD (entry date)
  time       String?  // Format: HH:MM (when trade was taken)
  ticker     String   // Symbol (ES, NQ, SPY, AAPL, etc.)
  direction  String   // LONG or SHORT
  entryPrice Float?   // Entry price
  exitPrice  Float?   // Exit price
  size       Float?   // Number of contracts/shares
  pnl        Float    // Profit/Loss for this trade
  notes      String?  // Trade-specific notes

  // Asset type and trade status
  assetType  String   @default("STOCK")  // STOCK, FUTURES, OPTIONS, FOREX, CRYPTO
  status     String   @default("CLOSED") // OPEN, CLOSED
  closeDate  String?  // Date trade was closed (for swing trades)

  // Options-specific fields (only used when assetType = OPTIONS)
  optionType       String?  // CALL or PUT
  strikePrice      Float?   // Strike price
  expirationDate   String?  // Expiration date (YYYY-MM-DD)
  premium          Float?   // Premium paid/received
  underlyingTicker String?  // Underlying symbol (e.g., SPY for SPY options)

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Simple string array for tags (e.g., ["Breakout", "FOMO"])
  tags           String[] @default([])
  // Relation to strategy trades
  strategyTrades StrategyTrade[]

  @@index([userId])
  @@index([date])
  @@index([userId, date])
  @@index([status])
}

// ============================================
// STRATEGIES FEATURE (Simplified)
// ============================================

model Strategy {
  id                  String   @id @default(cuid())
  userId              String   // Clerk user ID (creator/owner)
  name                String   // e.g., "Momentum", "Breakout"
  description         String?  // Detailed strategy description
  type                String   // e.g., "MOMENTUM", "BREAKOUT", "REVERSAL", "SCALPING"
  status              String   @default("ACTIVE") // ACTIVE, PAUSED, ARCHIVED
  color               String   @default("#3b82f6") // UI display color
  defaultRiskPercent  Float?   // Default risk per trade
  maxDrawdownPercent  Float?   // Maximum allowed drawdown
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  trades StrategyTrade[]

  @@index([userId])
  @@index([status])
}

model StrategyTrade {
  id         String   @id @default(cuid())
  strategyId String
  tradeId    String?  // Link to existing Trade (optional)

  // If not linked to Trade, manual entry fields:
  date       String   // YYYY-MM-DD
  time       String?  // HH:MM
  ticker     String
  direction  String   // LONG or SHORT
  entryPrice Float?
  exitPrice  Float?
  size       Float?
  pnl        Float
  notes      String?
  isBacktest Boolean  @default(false) // true = historical backtest entry
  createdAt  DateTime @default(now())

  strategy Strategy @relation(fields: [strategyId], references: [id], onDelete: Cascade)
  trade    Trade?   @relation(fields: [tradeId], references: [id], onDelete: SetNull)

  @@index([strategyId])
  @@index([tradeId])
  @@index([date])
  @@index([isBacktest])
}
